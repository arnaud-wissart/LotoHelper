<section class="predictions-container">
  <header>
    <p class="eyebrow">Prédictions</p>
    <h1>Simulations pondérées</h1>
    <p class="subtitle">Générez des grilles basées sur l'historique. Résultats purement indicatifs.</p>
  </header>

  <section class="controls">
    <div class="count-control">
      <mat-form-field appearance="outline">
        <mat-label>Nombre de tirages à générer</mat-label>
        <input matInput type="number" [(ngModel)]="count" [min]="minCount" [max]="maxCount">
        <mat-hint>Entre {{ minCount }} et {{ maxCount }}</mat-hint>
      </mat-form-field>
    </div>

    <div class="strategy-control">
      <mat-form-field appearance="outline">
        <mat-label>Stratégie</mat-label>
        <mat-select [(value)]="selectedStrategy">
          <mat-option *ngFor="let s of strategies" [value]="s.value">
            {{ s.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <p class="strategy-description">
        {{ selectedStrategyDescription }}
      </p>
    </div>

    <div class="advanced-toggle">
      <button mat-stroked-button type="button" (click)="toggleAdvanced()">
        {{ showAdvanced ? 'Masquer' : 'Afficher' }} les options avancées
      </button>
    </div>

    <div class="advanced" *ngIf="showAdvanced">
      <div class="advanced-grid">
        <mat-form-field appearance="outline">
          <mat-label>Somme min</mat-label>
          <input matInput type="number" [(ngModel)]="minSum" placeholder="ex : 100">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Somme max</mat-label>
          <input matInput type="number" [(ngModel)]="maxSum" placeholder="ex : 200">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Paires min</mat-label>
          <input matInput type="number" [(ngModel)]="minEven" min="0" max="5" placeholder="0..5">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Paires max</mat-label>
          <input matInput type="number" [(ngModel)]="maxEven" min="0" max="5" placeholder="0..5">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>≤ 25 min</mat-label>
          <input matInput type="number" [(ngModel)]="minLow" min="0" max="5" placeholder="0..5">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>≤ 25 max</mat-label>
          <input matInput type="number" [(ngModel)]="maxLow" min="0" max="5" placeholder="0..5">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Inclure (ex: 3,7,12)</mat-label>
          <input matInput type="text" [(ngModel)]="includeNumbersInput">
          <mat-hint>Jusqu'à 5 numéros forcés</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Exclure (ex: 1,2,30)</mat-label>
          <input matInput type="text" [(ngModel)]="excludeNumbersInput">
        </mat-form-field>
      </div>
      <p class="advanced-hint">
        Les contraintes sont optionnelles. La génération s'arrête si trop de grilles sont rejetées.
      </p>
    </div>

    <button mat-raised-button color="primary" (click)="onGenerateClick()" [disabled]="isLoading">
      Générer les prédictions
    </button>
  </section>

  <section class="animation" *ngIf="isAnimating">
    <div class="spinner-wrapper">
      <mat-progress-spinner mode="indeterminate" diameter="64"></mat-progress-spinner>
    </div>
    <div class="animation-text">
      <p>Analyse de l'historique des tirages...</p>
      <p>Calcul des probabilités et génération de vos grilles...</p>
    </div>
  </section>

  <section class="error" *ngIf="!isAnimating && errorMessage">
    {{ errorMessage }}
  </section>

  <section class="results" *ngIf="!isAnimating && !errorMessage">
    <div class="meta" *ngIf="predictions.length > 0">
      <p>
        {{ predictions.length }} tirage(s) généré(s)
        <span *ngIf="formatGeneratedAt()">le {{ formatGeneratedAt() }}</span>
      </p>
      <p *ngIf="lastUsedStrategy">
        Stratégie : {{ getStrategyLabel(lastUsedStrategy) }}
      </p>
    </div>

    <div class="predictions-list" *ngIf="predictions.length > 0; else noPredictions">
      <mat-card class="prediction-card" *ngFor="let p of predictions; trackBy: trackByIndex">
        <div class="numbers">
          <span class="ball" *ngFor="let n of p.numbers">{{ n }}</span>
          <span class="ball lucky">C {{ p.luckyNumber }}</span>
        </div>
        <div class="score"
             matTooltip="Indice relatif basé sur les fréquences passées : plus le score est haut, plus la grille reprend des numéros historiquement fréquents (aucune garantie de gain).">
          Score : {{ getScoreAsPercent(p.score) }}
        </div>
      </mat-card>
    </div>

    <ng-template #noPredictions>
      <p class="empty">Aucune prédiction générée pour le moment. Choisissez un nombre de tirages et cliquez sur "Générer les prédictions".</p>
    </ng-template>
  </section>
</section>
